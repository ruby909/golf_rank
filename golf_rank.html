<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>地面高爾夫比賽記分板</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        table { width: 90%; margin: 20px auto; border-collapse: collapse; }
        th, td { border: 1px solid black; padding: 10px; text-align: center; }
        th { background-color: #f2f2f2; }
        input { width: 80px; text-align: center; }
        button { margin: 10px; padding: 10px; font-size: 16px; cursor: pointer; }
    </style>
</head>
<body>

    <h2>🏌️ 地面高爾夫比賽記分板 🏌️‍♀️</h2>

    <table id="golfTable">
        <thead>
            <tr>
                <th>名次</th>
                <th>姓名</th>
                <th>出生民國年</th>
                <th>出生月</th>
                <th>出生日</th>
                <th>球賽1成績</th>
                <th>球賽2成績</th>
                <th>總分</th>
                <th>一桿進洞次數</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <button onclick="addRow()">➕ 新增參賽者</button>
    <button onclick="sortGolfRanking()">🏆 排序排名</button>
    <button onclick="exportToCSV()">📤 匯出 Excel</button>
    <input type="file" id="importFile" accept=".csv" onchange="importFromCSV()" />
    
    <script>
        function saveData() {
            let table = document.getElementById("golfTable").getElementsByTagName("tbody")[0];
            let data = [];
            for (let row of table.rows) {
                let rowData = [];
                for (let i = 1; i < 9; i++) {
                    rowData.push(row.cells[i].children[0] ? row.cells[i].children[0].value : row.cells[i].textContent);
                }
                data.push(rowData);
            }
            localStorage.setItem("golfData", JSON.stringify(data));
        }

        function loadData() {
            let table = document.getElementById("golfTable").getElementsByTagName("tbody")[0];
            let data = JSON.parse(localStorage.getItem("golfData") || "[]");
            table.innerHTML = "";
            data.forEach(rowData => {
                let newRow = table.insertRow();
                newRow.insertCell(0).textContent = ""; // 名次
                for (let i = 1; i < 9; i++) {
                    let cell = newRow.insertCell(i);
                    let input = document.createElement("input");
                    input.type = (i === 1) ? "text" : "number";
                    input.value = rowData[i - 1] || 0; // 預設為 0
                    if (i === 5 || i === 6) {
                        input.oninput = function() { updateTotal(input); };
                    }
                    input.onchange = saveData;
                    cell.appendChild(input);
                }
                newRow.insertCell(8).textContent = rowData[6] || "0"; // 預設總分
                let deleteCell = newRow.insertCell(9);
                let deleteButton = document.createElement("button");
                deleteButton.innerText = "刪除";
                deleteButton.onclick = function() { deleteRow(this); };
                deleteCell.appendChild(deleteButton);
            });
            sortGolfRanking();
        }

        function sortGolfRanking() {
            let table = document.getElementById("golfTable");
            let rows = Array.from(table.getElementsByTagName("tbody")[0].rows);

            rows.sort(function(rowA, rowB) {
                let scoreA = parseInt(rowA.cells[7].textContent) || 0;
                let scoreB = parseInt(rowB.cells[7].textContent) || 0;
                let holeInOneA = parseInt(rowA.cells[8].children[0].value) || 0;
                let holeInOneB = parseInt(rowB.cells[8].children[0].value) || 0;
                let yearA = parseInt(rowA.cells[2].children[0].value) || 0;
                let yearB = parseInt(rowB.cells[2].children[0].value) || 0;
                let monthA = parseInt(rowA.cells[3].children[0].value) || 0;
                let monthB = parseInt(rowB.cells[3].children[0].value) || 0;
                let dayA = parseInt(rowA.cells[4].children[0].value) || 0;
                let dayB = parseInt(rowB.cells[4].children[0].value) || 0;

                return scoreA - scoreB || holeInOneB - holeInOneA || yearA - yearB || monthA - monthB || dayA - dayB;
            });

            let tbody = table.getElementsByTagName("tbody")[0];
            tbody.innerHTML = "";
            rows.forEach((row, index) => {
                row.cells[0].textContent = index + 1;
                tbody.appendChild(row);
            });
            saveData();
        }

        window.onload = loadData;
    </script>

</body>
</html>

